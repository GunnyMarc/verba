{% extends "base.html" %}
{% block title %}Verba â€” Summarize Transcript{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Transcript Summarization</h1>
    <p class="subtitle">Summarize transcripts using local or cloud LLMs</p>
</div>

<div class="card form-card">
    <form hx-post="/transtr/process"
          hx-target="#result-area"
          hx-swap="innerHTML"
          hx-encoding="multipart/form-data"
          hx-indicator="#process-indicator">

        <div class="form-row">
            <label class="toggle-label">
                <input type="checkbox" name="batch_process" value="on"
                       onchange="document.getElementById('text-input-group').style.display = this.checked ? 'none' : 'block'; document.getElementById('file-input-group').style.display = this.checked ? 'none' : 'block'; document.getElementById('batch-input-group').style.display = this.checked ? 'block' : 'none'">
                <span class="toggle-text">Batch Process</span>
                <span class="toggle-hint">Process all transcript files in a directory</span>
            </label>
        </div>

        <div id="text-input-group" class="form-row">
            <label class="form-label" for="text">Transcript Text</label>
            <textarea id="text" name="text" rows="8" class="form-textarea"
                      placeholder="Paste your transcript text here..."></textarea>
        </div>

        <div id="file-input-group" class="form-row">
            <label class="form-label" for="file">Or Upload File</label>
            <input type="file" id="file" name="file"
                   accept=".txt,.md,.csv,.rtf,.tsv"
                   class="file-input">
            <span class="form-hint">Supported: {{ supported_formats }}</span>
        </div>

        <div id="batch-input-group" class="form-row" style="display:none">
            <label class="form-label" for="input_dir">Transcript Input Directory</label>
            <div class="input-with-browse">
                <input type="text" id="input_dir" name="input_dir"
                       value="{{ settings.summary_input_dir }}"
                       class="form-input">
                <button type="button" class="btn btn--browse"
                        onclick="document.getElementById('browse-modal').style.display='flex'; htmx.ajax('GET', '/transtr/browse?path=' + encodeURIComponent(document.getElementById('input_dir').value) + '&target=input_dir', '#browse-modal-content')">
                    Browse
                </button>
            </div>
        </div>

        <div class="form-grid">
            <div class="form-row">
                <label class="form-label" for="model">LLM Model</label>
                <select id="model" name="model" class="form-select">
                    {% for category, models in available_models.items() %}
                    <optgroup label="{{ category }}">
                        {% for m in models %}
                        <option value="{{ m }}">{{ model_labels.get(m, m) }}</option>
                        {% endfor %}
                    </optgroup>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="form-row">
            <label class="form-label" for="instructions">Instructions</label>
            <textarea id="instructions" name="instructions" rows="4" class="form-textarea"
                      placeholder="Summarize the following transcript clearly and concisely.">Summarize the following transcript clearly and concisely.</textarea>
        </div>

        <div class="form-row">
            <label class="form-label" for="instructions_file">Input Instructions File</label>
            <input type="file" id="instructions_file" name="instructions_file"
                   accept=".txt,.csv,.xlsx,.doc,.docx,.md,.pdf"
                   class="file-input">
            <span class="form-hint">Supported: {{ instructions_formats }}. Overrides the instructions text above when provided.</span>
        </div>

        <div class="form-row">
            <label class="form-label" for="output_dir">Summary Output</label>
            <div class="input-with-browse">
                <input type="text" id="output_dir" name="output_dir"
                       value="{{ settings.summary_output_dir }}"
                       class="form-input">
                <button type="button" class="btn btn--browse"
                        onclick="document.getElementById('browse-modal').style.display='flex'; htmx.ajax('GET', '/transtr/browse?path=' + encodeURIComponent(document.getElementById('output_dir').value) + '&target=output_dir', '#browse-modal-content')">
                    Browse
                </button>
            </div>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn--primary">
                <span class="btn-text">Summarize</span>
                <span id="process-indicator" class="htmx-indicator spinner"></span>
            </button>
        </div>
    </form>
</div>

<div id="result-area"></div>

<div id="browse-modal" class="browse-modal" style="display:none">
    <div class="browse-modal-dialog" id="browse-modal-content"></div>
</div>
{% endblock %}
